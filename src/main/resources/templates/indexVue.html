<!--  Created by IntelliJ IDEA.
  User: s lion h
  Date: 2018/4/17
  Time: 23:11
  To change this template use File | Settings | File Templates.-->
<html xmlns:th="http://www.thumeleaf.org">
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Big Calendar</title>

<link href="https://cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">

<!-- Google Font embed -->
<link href="https://fonts.googleapis.com/css?family=Josefin+Sans:300,400,600,700|Ubuntu:300,400,500,700" rel="stylesheet">
<script src="https://cdn.bootcss.com/jquery/2.2.4/jquery.js"></script>
<script src="https://cdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.js"></script>
<script src="https://cdn.bootcss.com/vue/2.5.16/vue.min.js"></script>

<style type="text/css">
    .modal-contant{
        background: #fff;
    }
    .popover.left {
        margin-left: -65px;
    }
    .loading {
        　　position:fixed;
        　　width:100%;
        　　height:100%;
        background:rgba(153,153,153,0.2);
        color:#FFF;
        top:0px;
    }
    .inMiddle{
        position: relative;
        top: 40%;
        transform: translateY(-50%);
        text-align:center;
        font-size: 80px;
    }
    .myEvent{
        color: #ff99cc;
        font-size: 18px;
        font-weight: bolder;
    }
    .myRepository{
        color: #0b90ff;
        font-size: 15px;
        font-weight: bolder;
    }
    #di_float{
        width:280px;
        /*height:250px;*/
        border:1px solid #0b90ff;
        position:fixed;
        right:30px;
        top:50%;
        /*top:400px;*/
        background: #e1f4f9;
    }
    .ipos{
        font-size: 26px;
        margin-bottom: 0;
        color: #88aaff;
    }
    #iposmsg{
        font-size: 20px;
        /*display: ;*/
        /*visibility: hidden;*/
    }
</style>
</head>



<body  data-spy="scroll" data-target="#myScrollspy" data-offset="50">

<main class="container-fluid main-container">
    <!-- main shows -->
    <div class="row" id="calendar">
        <div class="col-md-2 col-sm-2 month-slider">
            <!-- left data -->
            <nav class="navbar" id="myScrollspy">
                <ul class="nav nav-pills nav-stacked">
                    <li><a href="">&nbsp;</a></li>
                    <li ><a @click="getMonth(1)">January</a></li>
                    <li ><a @click="getMonth(2)">February</a></li>
                    <li ><a @click="getMonth(3)">March</a></li>
                    <li ><a @click="getMonth(4)">April</a></li>
                    <li ><a @click="getMonth(5)">May</a></li>
                    <li ><a @click="getMonth(6)">June</a></li>
                    <li ><a @click="getMonth(7)">July</a></li>
                    <li ><a @click="getMonth(8)">August</a></li>
                    <li ><a @click="getMonth(9)">September</a></li>
                    <li ><a @click="getMonth(10)">October</a></li>
                    <li ><a @click="getMonth(11)">November</a></li>
                    <li ><a @click="getMonth(12)">December</a></li>
                    <li >&nbsp;</li>
                    <li >&nbsp;</li>
                    <li >&nbsp;</li>
                    <li >&nbsp;</li>
                    <li class="text-center">粤ICP备17096671号</li>
                </ul>
            </nav>
        </div>

        <!-- total on middle -->
        <div class="col-md-9 col-sm-9 date-container">
            <!-- The days are listed on top -->
            <div class="table-responsive days-headings">
                <table class="table">
                    <tr>
                        <th>M</th>
                        <th>T</th>
                        <th>W</th>
                        <th>T</th>
                        <th>F</th>
                        <th>S</th>
                        <th>S</th>
                    </tr>
                </table>
            </div>


            <div class="dates-content table-responsive">
                <table class="table">
                <!--<table id="calendar" class="table">-->
                    <tbody class="text-center">
                    <tr v-for="m in 6">
                        <template v-if="m==1">
                            <td v-for="n in dayOfWeek-1">&nbsp;</td>
                            <td v-for="i in 8-dayOfWeek">
                                <!--<h2><a onclick="getDay(this)">{{cDays[i-1].day}}</a></h2>-->
                                <h2><a @click="showDate($event)">{{cDays[i-1].day}}</a></h2>
                                <!--<h2 class="btn btn-default">{{cDays[i-1].day}}</h2>-->
                                <h3></h3>
                                <ul class='list-unstyled'>
                                    <li v-for="event in cDays[i-1].event" class="myEvent">
                                        {{event.event}}
                                    </li>
                                    <li>The event will come here</li>
                                    <li>The events will come here</li>
                                </ul>
                            </td>
                            </a>
                        </template>
                        <template v-if="m==2">
                            <td v-for="i in 7">
                                <h2><a @click="showDate($event)">{{cDays[second-2+i].day}}</a></h2>
                                <h3></h3>
                                <ul class='list-unstyled'>
                                    <li v-for="event in cDays[second-2+i].event" class="myEvent">
                                        {{event.event}}
                                    </li>
                                    <li>The event will come here</li>
                                    <li>The events will come here</li>
                                </ul>
                            </td>
                        </template>
                        <template v-if="m==3">
                            <td v-for="i in 7">
                                <h2><a @click="showDate($event)">{{cDays[third-2+i].day}}</a></h2>
                                <h3></h3>
                                <ul class='list-unstyled'>
                                    <li v-for="event in cDays[third-2+i].event" class="myEvent">
                                        {{event.event}}
                                    </li>
                                    <li>The event will come here</li>
                                    <li>The events will come here</li>
                                </ul>
                            </td>
                        </template>
                        <template v-if="m==4">
                            <td v-for="i in 7">
                                <h2><a @click="showDate($event)">{{cDays[forth-2+i].day}}</a></h2>
                                <h3></h3>
                                <ul class='list-unstyled'>
                                    <li v-for="event in cDays[forth-2+i].event" class="myEvent">
                                        {{event.event}}
                                    </li>
                                    <li>The event will come here</li>
                                    <li>The events will come here</li>
                                </ul>
                            </td>
                        </template>
                        <template v-if="m==5">
                            <td v-for="i in 7">
                                <template v-if="((m-1)*7+i-dayOfWeek+1) <= days">
                                    <h2><a @click="showDate($event)">{{cDays[five-2+i].day}}</a></h2>
                                    <h3></h3>
                                    <ul class='list-unstyled'>
                                        <li v-for="event in cDays[five-2+i].event" class="myEvent">
                                            {{event.event}}
                                        </li>
                                        <li>The event will come here</li>
                                        <li>The events will come here</li>
                                    </ul>
                                </template>
                            </td>
                        </template>
                        <template v-if="m==6">
                            <td v-for="i in 7">
                                <template v-if="((m-1)*7+i-dayOfWeek+1) <= days">
                                    <h2><a @click="showDate($event)">{{cDays[six-2+i].day}}</a></h2>
                                    <h3></h3>
                                    <ul class='list-unstyled'>
                                        <li v-for="event in cDays[six-2+i].event" class="myEvent">
                                            {{event.event}}
                                        </li>
                                        <li>The event will come here</li>
                                        <li>The events will come here</li>
                                    </ul>
                                </template>
                            </td>
                        </template>
                    </tr>
                    </tbody>
                </table>

            </div>

        </div>
        <!--右侧个人信息栏-->
        <div th:include="nav::side"></div>

        <!--信息栏-->
        <div id="di_float" class="row">
            <p class="text-center ipos">IPOs</p>
            <!--<ul>
                <li v-for="ipo in ipolist">
                    {{ipo.company_name}}
                </li>
            </ul>-->
            <table class="table table-bordered table-hover text-center">
                <thead>
                <tr>
                    <td>公司名</td>
                    <td>地区</td>
                    <td>img</td>
                </tr>
                </thead>
                <tbody>
                <tr v-for="ipo in ipolist">
                    <td>{{ipo.company_name}}</td>
                    <td>{{ipo.country}}</td>
                    <td><img :src="ipo.flag_uri" class="img-responsive"/></td>
                    <!--<td>{{ipo.flag_uri}}</td>-->
                </tr>
                </tbody>
            </table>
            <div id="iposmsg" class="row ">
                <p class="text-center text-danger">此日无IPO信息</p>
            </div>
        </div>
    </div>
</main>
</body>
<script>
    var today = new Date();//获得当前日期
    var thisMonth = today.getMonth() + 1;
    $('ul.nav > li:nth-child('+(thisMonth+1)+')').addClass('active');
    $(document).ready(function(){
        $('ul.nav > li').click(function (e) {
            e.preventDefault();
            $('ul.nav > li').removeClass('active');
            $(this).addClass('active');
        });
    });
    $.ajaxSettings.async = false;
    var result;
    $.getJSON("/getMonthJsonCalendar?month="+thisMonth,function (cresult, status) {
        result=cresult;
    });
    var v = new Vue({
        el: '#calendar',
        data: {
            year: result.year,
            month: result.month,
            today: result.today,
            dayOfWeek: result.dayOfWeek,
            days:result.days,
            cDays: result.cDays,
            second: 9-result.dayOfWeek,
            third: 16-result.dayOfWeek,
            forth: 23-result.dayOfWeek,
            five: 30-result.dayOfWeek,
            six: 37-result.dayOfWeek,
            ipolist:[]
            // ipolist:[{"id":201,"code":"03690","company_name":"美团点评-Ｗ","company_name_en":"","country":"香港","country_id":"HK","flag_uri":"https://wpimg.wallstcn.com/05/c0/05/hongkong-2x.png","exchange_code":"","public_date":1537401600,"price_upper":"72.00","price_floor":"60.00","listed_price":"69.00","currency":"HKD","currency_name":"港元","shares":"480.27","market_value":"31697.72","status":"0","visible":false,"calendar_type":"FI","subscribe_status":false},{"id":207,"code":"BSVN","company_name":"Bank7","company_name_en":"","country":"美国","country_id":"US","flag_uri":"https://wpimg.wallstcn.com/32/75/86/usa-2x.png","exchange_code":"","public_date":1537446600,"price_upper":"19.00","price_floor":"19.00","listed_price":"19.00","currency":"USD","currency_name":"美元","shares":"3.4","market_value":"64.6","status":"0","visible":false,"calendar_type":"FI","subscribe_status":false},{"id":204,"code":"EB","company_name":"Eventbrite","company_name_en":"","country":"美国","country_id":"US","flag_uri":"https://wpimg.wallstcn.com/32/75/86/usa-2x.png","exchange_code":"","public_date":1537446600,"price_upper":"23.00","price_floor":"23.00","listed_price":"23.00","currency":"USD","currency_name":"美元","shares":"10.0","market_value":"230.0","status":"0","visible":false,"calendar_type":"FI","subscribe_status":false},{"id":199,"code":"ELAN","company_name":"Elanco动物健康","company_name_en":"","country":"美国","country_id":"US","flag_uri":"https://wpimg.wallstcn.com/32/75/86/usa-2x.png","exchange_code":"","public_date":1537446600,"price_upper":"24.00","price_floor":"24.00","listed_price":"24.00","currency":"USD","currency_name":"美元","shares":"62.9","market_value":"1509.6","status":"0","visible":false,"calendar_type":"FI","subscribe_status":false}]

        },
        methods:{
            getMonth:function(month){
                var getMessage;
                $.getJSON("/getMonthJsonCalendar?month="+month,function (result, status) {
                    getMessage=result;
                    console.log(getMessage);
                });
                this.year= getMessage.year;
                this.month= getMessage.month;
                this.today= getMessage.today;
                this.dayOfWeek= getMessage.dayOfWeek;
                this.cDays= getMessage.cDays;
                this.days=getMessage.days;
                this.second= 9-getMessage.dayOfWeek;
                this.third= 16-getMessage.dayOfWeek;
                this.forth= 23-getMessage.dayOfWeek;
                this.five= 30-getMessage.dayOfWeek;
                this.six= 37-getMessage.dayOfWeek;
            },
            showDate(event){
                /*
                * 用事件+innertext+vue的data
                * 获取当前选择的日期
                * */
                // console.log(this.year)
                // console.log(this.month)
                // console.log(event.currentTarget.innerText)

                var myDate=new Date()
                myDate.setFullYear(this.year,this.month-1,event.currentTarget.innerText)
                // console.log(new Date().Format("yyyy-MM-dd"))
                // console.log(myDate.Format("yyyy-MM-dd"))
                console.log(getDateFormatDate(myDate))
                // console.log(getIPODatas(getDateFormatDate(myDate)))
                this.ipolist=getIPODatas(getDateFormatDate(myDate))
                // console.log(this.ipolist==[])
                if(Array.isArray(this.ipolist) && this.ipolist.length === 0){
                    console.log('是空数组');
                    // document.getElementById("iposmsg").style.visibility="visible"
                    document.getElementById("iposmsg").style.display=""

                }else{
                    console.log('有ipo数据');
                    // document.getElementById("iposmsg").style.visibility="hidden";
                    document.getElementById("iposmsg").style.display="none";
                }

            }
        },
        created:function () {
            console.log("created")
            var today=getNowFormatDate();
            console.log(today)
            this.ipolist=getIPODatas(today)
            // console.log(this.ipolist==[])
            if(Array.isArray(this.ipolist) && this.ipolist.length === 0){
                console.log('是空数组');
                // document.getElementById("iposmsg").style.visibility="visible"
                document.getElementById("iposmsg").style.display=""

            }else{
                console.log('有ipo数据');
                // document.getElementById("iposmsg").style.visibility="hidden";
                document.getElementById("iposmsg").style.display="none";
            }
        }
    })
    // 获取点击日期
    function getDay(day) {
        // alert($(day).val)
        console.log(day.innerText)
        
    }
    function getDateFormatDate(date) {
        // var date = new Date();
        var year = date.getFullYear();
        var month = date.getMonth() + 1;
        var strDate = date.getDate();
        if (month >= 1 && month <= 9) {
            month = '0' + month;
        }
        if (strDate >= 0 && strDate <= 9) {
            strDate = '0' + strDate;
        }
        var currentdate = year + '-' + month + '-' + strDate;
        return currentdate;
    }
    function getIPODatas(date){

        console.log(date);
        var timestamp=new Date(date);
        var startstamp=timestamp.getTime()-28800000
        var endstamp=startstamp+86399000
        var start=startstamp+""
        var end=endstamp+""
        // console.log(start)

        var start=start.substring(0,start.length-3)
        var end=end.substring(0,end.length-3)
        console.log(start)
        console.log(end)

        var requestresult
        $.getJSON("/getIPODatas?start="+start+"&end="+end,function (cresult, status) {
            // console.log(data.ipolist)
            result=cresult;
            console.log(result)
            requestresult=result
            // data.ipolist=result
            // console.log(data.ipolist)
        });

        return requestresult
    }
    // 获取今日yyyy-dd-mm
    function getNowFormatDate() {
        var date = new Date();
        var year = date.getFullYear();
        var month = date.getMonth() + 1;
        var strDate = date.getDate();
        if (month >= 1 && month <= 9) {
            month = '0' + month;
        }
        if (strDate >= 0 && strDate <= 9) {
            strDate = '0' + strDate;
        }
        var currentdate = year + '-' + month + '-' + strDate;
        return currentdate;
    }
</script>
</html>